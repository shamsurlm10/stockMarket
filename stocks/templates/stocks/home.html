<html>
<head>
    <title>Stock Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        canvas {
            max-width: 800px;
        }
    </style>
</head>
<body>
    <h1>Stock Data</h1>

    <!-- Line chart and dropdown for trade_code selection -->
    <div>
        <label for="tradeCodeDropdown">Select Trade Code:</label>
        <select id="tradeCodeDropdown" onchange="updateChartData()">
            <option value="all">All Trade Codes</option>
            <!-- Add options dynamically based on available trade codes -->
            {% for trade_code in trade_codes %}
                <option value="{{ trade_code }}">{{ trade_code }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <canvas id="lineChart"></canvas>
    </div>

    <table>
        <!-- ... table code ... -->
    </table>

    <a href="{% url 'stock_create' %}">Add Stock</a>



    <!-- line chart -->
    <div>
        <label for="tradeCodeDropdown">Select Trade Code:</label>
        <select id="tradeCodeDropdown" onchange="updateChartData()">
            <option value="all">All Trade Codes</option>
            <!-- Add options dynamically based on available trade codes -->
            {% for trade_code in trade_codes %}
                <option value="{{ trade_code }}">{{ trade_code }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Line chart -->
    <div>
        <canvas id="lineChart"></canvas>
    </div>

    <!-- Bar chart for volume -->
    <div>
        <canvas id="barChart"></canvas>
    </div>

    <!-- <script>
        var stocksData = JSON.parse('{{ stocks_json|escapejs }}');
        var chartData = [];
        var labels = [];

        function filterStocksByTradeCode(tradeCode) {
            if (tradeCode === 'all') {
                return stocksData;
            } else {
                return stocksData.filter(function (stock) {
                    return stock.trade_code === tradeCode;
                });
            }
        }

        function updateChartData() {
            var selectedTradeCode = document.getElementById('tradeCodeDropdown').value;
            var filteredStocks = filterStocksByTradeCode(selectedTradeCode);

            // Extract labels and data for the line chart
            labels = filteredStocks.map(function (stock) {
                return stock.date;
            });

            chartData = filteredStocks.map(function (stock) {
                return stock.close;
            });

            updateChart();
        }

        function updateChart() {
            var ctx = document.getElementById('lineChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Close Prices',
                        data: chartData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        x: [{
                            type: 'linear',
                            position: 'bottom'
                        }]
                    }
                }
            });
        }

        // Initial call to set up the chart
        updateChartData();
    </script> -->

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Trade Code</th>
                <th>High</th>
                <th>Low</th>
                <th>Open</th>
                <th>Close</th>
                <th>Volume</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for stock in stocks %}
                <tr>
                    <td>{{ stock.date }}</td>
                    <td>{{ stock.trade_code }}</td>
                    <td>{{ stock.high }}</td>
                    <td>{{ stock.low }}</td>
                    <td>{{ stock.open }}</td>
                    <td>{{ stock.close }}</td>
                    <td>{{ stock.volume }}</td>
                    <td>
                        <a href="{% url 'stock_edit' pk=stock.pk %}">Update</a>
                        <a href="{% url 'stock_delete' pk=stock.pk %}">Delete</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        <span class="step-links">
            {% if stocks.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ stocks.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ stocks.number }} of {{ stocks.paginator.num_pages }}.
            </span>

            {% if stocks.has_next %}
                <a href="?page={{ stocks.next_page_number }}">next</a>
                <a href="?page={{ stocks.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>



    <script>
        var stocksData = JSON.parse('{{ stocks_json|escapejs }}');
        var chartData = [];
        var labels = [];

        function filterStocksByTradeCode(tradeCode) {
            if (tradeCode === 'all') {
                return stocksData;
            } else {
                return stocksData.filter(function (stock) {
                    return stock.trade_code === tradeCode;
                });
            }
        }

        function updateChartData() {
            var selectedTradeCode = document.getElementById('tradeCodeDropdown').value;
            var filteredStocks = filterStocksByTradeCode(selectedTradeCode);

            // Extract labels and data for the line chart
            labels = filteredStocks.map(function (stock) {
                return stock.date;
            });

            chartData = filteredStocks.map(function (stock) {
                return stock.close;
            });

            // Update line chart
            updateLineChart();

            // Extract data for the bar chart (volume)
            var volumeData = filteredStocks.map(function (stock) {
                return stock.volume;
            });

            // Update bar chart
            updateBarChart(volumeData);
        }

        function updateLineChart() {
            var ctx = document.getElementById('lineChart').getContext('2d');
            var myLineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Close Prices',
                        data: chartData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        x: [{
                            type: 'linear',
                            position: 'bottom'
                        }]
                    }
                }
            });
        }

        function updateBarChart(volumeData) {
            var ctx = document.getElementById('barChart').getContext('2d');
            var myBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Volume',
                        data: volumeData,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: [{
                            type: 'linear',
                            position: 'left'
                        }]
                    }
                }
            });
        }

        // Initial call to set up the charts
        updateChartData();
    </script>
</body>
</html>